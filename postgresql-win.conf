# PostgreSQL Configuration for Windows Development
# Optimized for local development on Windows machines with reduced resource usage

# Connection Settings (reduced for development)
max_connections = 100  # Reduced from 400 for local development
listen_addresses = '*'

# Memory Settings (optimized for local development - ~8-16GB RAM typical)
shared_buffers = 1GB          # Reduced from 6GB (typically 25% of available RAM)
effective_cache_size = 4GB    # Reduced from 16GB (typically 75% of available RAM)  
work_mem = 4MB               # Reduced from 6MB for lighter queries
maintenance_work_mem = 128MB  # Reduced from 256MB for development

# Write-Ahead Logging (WAL) - development settings
wal_buffers = 16MB           # Reduced from 32MB
checkpoint_completion_target = 0.9  # Higher for development (less frequent checkpoints)
max_wal_size = 512MB         # Reduced from 1GB
min_wal_size = 128MB         # Reduced from 256MB

# Query Planner (development-friendly)
random_page_cost = 1.1       # Lower for SSD (Windows development machines typically use SSD)
seq_page_cost = 1.0
effective_io_concurrency = 4 # Higher for modern Windows SSDs

# Background Writer (lighter for development)
bgwriter_delay = 300ms       # Slightly higher delay for development
bgwriter_lru_maxpages = 50   # Reduced from 100
bgwriter_lru_multiplier = 1.5  # Reduced from 2.0

# Autovacuum (development settings)
autovacuum = on
autovacuum_max_workers = 2   # Reduced from 4 for development
autovacuum_naptime = 120s    # Increased from 60s (less aggressive for development)

# Logging (development-friendly with more detailed logging)
log_statement = 'mod'        # Log DDL statements (CREATE, ALTER, DROP) for development
log_min_duration_statement = 1000  # Reduced from 2000ms to catch slower queries earlier
log_line_prefix = '%t [%p]: %u@%d '  # Add timestamp, process ID, user, database
log_checkpoints = on         # Log checkpoint activity for development monitoring
log_connections = on         # Log connections for development debugging
log_disconnections = on      # Log disconnections for development debugging

# Development-specific settings
log_lock_waits = on          # Log lock waits for debugging
log_temp_files = 10MB        # Log temporary files > 10MB
log_autovacuum_min_duration = 0  # Log all autovacuum activity

# Performance settings for development
checkpoint_timeout = 15min   # Increased from default for less aggressive checkpointing
synchronous_commit = off     # Disable for faster development (data safety not critical)
fsync = off                  # Disable for faster development (WARNING: data safety risk)

# Windows-specific optimizations
# Note: fsync and synchronous_commit are disabled for development speed
# These settings prioritize performance over data durability - acceptable for local development
# but should NEVER be used in production!

# Timezone (adjust as needed for development location)
timezone = 'Asia/Jakarta'

# Memory overcommit handling (Windows-friendly)
vm.overcommit_memory = 2     # Conservative memory allocation for Windows
